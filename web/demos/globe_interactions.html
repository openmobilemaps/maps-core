<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Web Map SDK Playground</title>
    <link rel="stylesheet" href="./assets/style.css" />
  </head>
  <body>
    <h1>Web Map SDK Playground</h1>
    <hr />
    <figure style="overflow: visible" id="spinner">
      <div class="spinner"></div>
      <center style="margin-top: 0.5em"><strong>emscripten</strong></center>
    </figure>
    <div class="emscripten" id="status">Downloading...</div>
    <div class="emscripten">
      <progress value="0" max="100" id="progress" hidden="1"></progress>
    </div>
    <div class="emscripten_border">
      <canvas class="emscripten" id="glCanvas" tabindex="-1"></canvas>
    </div>
    <hr />
    <div class="emscripten">
      <input type="checkbox" id="resize" />Resize canvas
      <input type="checkbox" id="pointerLock" checked />Lock/hide mouse pointer
      &nbsp;&nbsp;&nbsp;
      <input
        type="button"
        value="Fullscreen"
        onclick="module.requestFullscreen(document.getElementById('pointerLock').checked, 
                                                                                document.getElementById('resize').checked)"
      />
    </div>

    <hr />
    <textarea class="emscripten" id="output" rows="8"></textarea>
    <hr />
    <script type="module">
      import {
        initialize,
        registerAnimationLoop,
        registerTouchHandler,
      } from "./assets/map_setup.js";

      initialize("glCanvas", 160, true)
        .then(({ mapInterface, wmsdkModule, loader }) => {
          registerTouchHandler();

          const rasterLayer = wmsdkModule.Tiled2dMapRasterLayerInterface.create(
            wmsdkModule.DefaultTiled2dMapLayerConfigs.epsg4326Custom(
              "World",
              "https://wmsdk-playground.ubique.ch/restor_tiles/{z}/{x}/{y}.jpg",
              {
                zoomLevelScaleFactor: 1.0,
                numDrawPreviousLayers: 2,
                numDrawPreviousOrLaterTLayers: 0,
                adaptScaleToScreen: true,
                maskTile: false,
                underzoom: true,
                overzoom: true,
              },
              0,
              7
            ),
            [loader.asLoaderInterface()]
          );
          mapInterface.addLayer(rasterLayer.asLayerInterface());

          const glowLayer = wmsdkModule.SphereEffectLayerInterface.create();
          mapInterface.addLayer(glowLayer.asLayerInterface());

          var initialPos = {
            systemIdentifier:
              wmsdkModule.CoordinateSystemIdentifiers.EPSG4326(),
            x: 8.54359994,
            y: 47.37560515,
            z: 0,
          };
          const camera = mapInterface.getCamera();
          camera.setRotationEnabled(true);
          camera.moveToCenterPosition(initialPos, false);
          camera.setZoom(5_000_000, false);
          mapInterface.resume();

          registerAnimationLoop();
        })
        .catch((err) => {
          console.error("Failed to load WebMapSDK", err);
        });
    </script>
  </body>
</html>
